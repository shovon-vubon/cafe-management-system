<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
     <div class="logo"><a href="index.html"><img class="logom" src="img/logo-1.png" /></a></div>
     <div class="nav-bar">
        <div class="buttons">
          <button class="back-button" onclick="window.history.back()"><img class="arrow" src="img/arrow.png" /></button>
          <a href="homepage.html" class="scan-button"><img class="scan" src="img/scan.png" /></a>
          <button class="profile-button" onclick="toggleProfileDropdown()"><img class="user" src="img/user.png" /></button>
        </div>
        <div id="profileDropdown" class="profile-dropdown">
          <div class="dropdown-header">
            <div class="dropdown-user-icon">
              <img class="dropdown-user" src="img/user.png" />
            </div>
            <div class="dropdown-user-info">
              <div class="dropdown-username">Admin12</div>
              <div class="dropdown-email">admin123@gmail.com</div>
            </div>
          </div>
          <button class="logout-button" onclick="logout()">Logout</button>
        </div>
      </div>
    </header>
    <div class="add-menu">
      <img class="chips" src="https://c.animaapp.com/mjqemspvCihHiP/img/chips.png" />
      <img class="group" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/group-1.png" />
      <div class="login-card">
        <form action="" method="post" enctype="multipart/form-data">
          <div class="rectangle"></div>
          
          <!-- Photo Upload Section -->
          <label for="file-upload" style="cursor: pointer;">
            <div class="rectangle-2"></div>
            <img class="image" src="img/image- 1.png" id="preview-image" />
            <div class="text-wrapper-2">Upload Photo</div>
          </label>
          <input type="file" id="file-upload" name="photo" style="display: none;" accept="image/*" />
          <!-- Image picker from project img folder -->
          <div style="margin-top:8px; visibility: hidden;">
            <label for="imageSelect" class="text-wrapper-4"></label>
            <select id="imageSelect" style="display:block; margin-top:6px; padding:6px;">
              <option value=""></option>
            </select>
          </div>

          <!-- Form Inputs -->
          <div class="text-wrapper-3">Name</div>
          <input type="text" class="rectangle-3" name="name" />

          <div class="text-wrapper-4">Type</div>
          <input type="text" class="rectangle-4" name="type" />

          <div class="text-wrapper-5">Description</div>
          <textarea class="rectangle-7" name="description"></textarea>

          <div class="text-wrapper-6">Price</div>
          <input type="text" class="rectangle-5" name="price" />

          <!-- Save Button -->
          <button type="submit" class="rectangle-6" style="border: none; cursor: pointer;">
            <div class="text-wrapper-7" style="position: static; width: 100%; margin-top: 15px;">Save</div>
          </button>
        </form>
      </div>
      <footer class="footer">
        <div class="t-c">
          <div class="group-2">
            <div class="terms-conditions">Terms &amp; Conditions</div>
            <p class="p">Â© . All rights reserved</p>
            <div class="text-wrapper-11">Contact us</div>
          </div>
        </div>
      </footer>

    </div>
  </body>
  <script>
    (function(){
      // Hardcoded image list (files in /img). Adjust if you add/remove images.
      const images = [
        'tehari.png','drinks.png','coffee.png','noodles.png','khichuri.png','cake.png','samosa.png','french-fries.png','burger+frenchfry.png','chips.png','menu.png','image- 1.png'
      ];

      const select = document.getElementById('imageSelect');
      const preview = document.getElementById('preview-image');
      images.forEach(name => {
        const opt = document.createElement('option');
        opt.value = 'img/' + name;
        opt.textContent = name;
        select.appendChild(opt);
      });

      select.addEventListener('change', () => {
        if (select.value) preview.src = select.value;
      });

      // On file input change, show preview and clear select
      const fileInput = document.getElementById('file-upload');
      fileInput.addEventListener('change', e => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        preview.src = url;
        select.value = '';
      });

      // Handle form submit: save to localStorage and redirect to menu
      const form = document.querySelector('form');
      form.addEventListener('submit', function(e){
        e.preventDefault();
        const name = form.querySelector('input[name="name"]').value.trim();
        const type = form.querySelector('input[name="type"]').value.trim();
        const description = form.querySelector('textarea[name="description"]').value.trim();
        const price = form.querySelector('input[name="price"]').value.trim();

        if (!name) { alert('Please enter a name'); return; }

        const key = 'qrcafe_menu_items';
        const raw = localStorage.getItem(key);
        const items = raw ? JSON.parse(raw) : [];

        function saveAndRedirect(imageSrc){
          if (!items.some(i => i.name === name)) {
            items.push({ name, type, description, price, image: imageSrc });
            localStorage.setItem(key, JSON.stringify(items));
          }
          window.location.href = 'menu.html';
        }

        // If a file was uploaded, convert to base64 data URL first
        if (fileInput.files && fileInput.files[0]) {
          const file = fileInput.files[0];
          const reader = new FileReader();
          reader.onload = function(evt){
            saveAndRedirect(evt.target.result);
          };
          reader.readAsDataURL(file);
          return;
        }

        // Otherwise use selected image or preview src
        const imageSrc = select.value || preview.src || '';
        saveAndRedirect(imageSrc);
      });
    })();
    function toggleProfileDropdown() {
      const dropdown = document.getElementById('profileDropdown');
      dropdown.classList.toggle('active');
    }

    function logout() {
      alert('Logging out...');
    }

    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('profileDropdown');
      const profileButton = document.querySelector('.profile-button');
      if (dropdown && profileButton && !profileButton.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.classList.remove('active');
      }
    });
  </script>
</html>
