<!DOCTYPE html>
<html>
  <head>
	<script defer src="./injectScript.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
     <div class="logo"><a href="index.html"><img class="logom" src="img/logo-1.png" /></a></div>
     <div class="nav-bar">
        <div class="buttons">
          <button class="back-button" onclick="window.history.back()"><img class="arrow" src="img/arrow.png" /></button>
          <a href="homepage.html" class="scan-button"><img class="scan" src="img/scan.png" /></a>
          <button class="profile-button" onclick="toggleProfileDropdown()"><img class="user" src="img/user.png" /></button>
        </div>
        <div id="profileDropdown" class="profile-dropdown">
          <div class="dropdown-header">
            <div class="dropdown-user-icon">
              <img class="dropdown-user" src="img/user.png" />
            </div>
            <div class="dropdown-user-info">
              <div class="dropdown-username">Admin12</div>
              <div class="dropdown-email">admin123@gmail.com</div>
            </div>
          </div>
          <button class="logout-button" onclick="logout()">Logout</button>
        </div>
      </div>
    </header>
    <div class="cart-page">
      <img class="chips" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/chips.png" />
      <img class="chips" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/chips-1.png" />
      <img class="group" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/group-1.png" />
      
      <div class="frame">
        <!-- cart items will be rendered here from localStorage -->
        <div class="amount">
          <img class="vector" src="https://c.animaapp.com/mjqehbjb07P98X/img/vector.svg" />
          <img class="vector-2" src="https://c.animaapp.com/mjqehbjb07P98X/img/vector-1.svg" />
          <div id="cartTotal" class="text-wrapper-total">Total:BDT. <div class="varamount"> 0</div></div> 
          <a href="checkout.html"><div class="text-wrapper-3">Checkout</div></a>
          <a href="foodmenu.html"><div class="text-wrapper-4">Continue Shopping</div></a>

        </div>
      </div>
    
      <footer class="footer">
        <div class="t-c">
          <div class="group-2">
            <div class="terms-conditions">Terms &amp; Conditions</div>
            <p class="p">Â© . All rights reserved</p>
            <div class="text-wrapper-11">Contact us</div>
          </div>
        </div>
      </footer>
    
    </div>

  </body>

  <script>
    function toggleProfileDropdown() {
      const dropdown = document.getElementById('profileDropdown');
      dropdown.classList.toggle('active');
    }

    function logout() {
      alert('Logging out...');
    }

    // Cart operations: render from localStorage, update quantities, remove items.
    const CART_KEY = 'qrcafe_cart';

    function readCart(){
      try { return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); } catch(e){ return []; }
    }

    function writeCart(cart){
      try { localStorage.setItem(CART_KEY, JSON.stringify(cart)); } catch(e){}
    }

    function formatPrice(v){ return String(v); }

    function renderCart(){
  const frame = document.querySelector('.frame');
  if (!frame) return;

  // remove old rows
  Array.from(frame.querySelectorAll('.menu-item')).forEach(n => n.remove());

  const cart = readCart();
  let total = 0;

  if (!cart.length){
    const empty = document.createElement('div');
    empty.className = 'menu-item';
    empty.textContent = 'Your cart is empty.';
    frame.insertBefore(empty, frame.querySelector('.amount'));
  }

  cart.forEach(item => {
    const mi = document.createElement('div');
    mi.className = 'menu-item';
    mi.dataset.name = item.name;

    const rect2 = document.createElement('div'); rect2.className = 'rectangle-2';

    const img = document.createElement('img');
    img.className = 'front-view-tasty';
    img.src = item.image || 'img/image-1.png';

    const nameEl = document.createElement('div');
    nameEl.className = 'text-wrapper';
    nameEl.textContent = item.name;

    const addBtn = document.createElement('button');
    addBtn.className = 'add-btn';
    addBtn.innerHTML = `<img class="add" src="img/add.png"/>`;
    addBtn.onclick = () => addQuantityFor(item.name);

    const minusBtn = document.createElement('button');
    minusBtn.className = 'minus-btn';
    minusBtn.innerHTML = `<img class="minus" src="img/minus.png"/>`;
    minusBtn.onclick = () => decreaseQuantityFor(item.name);

    const binBtn = document.createElement('button');
    binBtn.className = 'bin-btn';
    binBtn.innerHTML = `<img class="bin" src="img/bin.png"/>`;
    binBtn.onclick = () => removeOrderFor(item.name);

    const unitPrice = parseFloat(item.price) || 0;
    const itemTotal = unitPrice * item.quantity;

    const priceEl = document.createElement('div');
    priceEl.className = 'price-BDT';
    priceEl.textContent = "BDT " + itemTotal;

    const qtyEl = document.createElement('div');
    qtyEl.className = 'text-wrapper-2';
    qtyEl.textContent = "Qty: " + item.quantity;

    mi.appendChild(rect2);
    mi.appendChild(img);
    mi.appendChild(nameEl);
    mi.appendChild(addBtn);
    mi.appendChild(minusBtn);
    mi.appendChild(binBtn);
    mi.appendChild(priceEl);
    mi.appendChild(qtyEl);

    frame.insertBefore(mi, frame.querySelector('.amount'));

    total += itemTotal;
  });

  // update varamount (bottom total)
  document.querySelector(".varamount").textContent = total;
}
function renderCart(){
  const frame = document.querySelector('.frame');
  if (!frame) return;

  // remove old rows
  Array.from(frame.querySelectorAll('.menu-item')).forEach(n => n.remove());

  const cart = readCart();
  let total = 0;

  if (!cart.length){
    const empty = document.createElement('div');
    empty.className = 'menu-item';
    empty.textContent = 'Your cart is empty.';
    frame.insertBefore(empty, frame.querySelector('.amount'));
  }

  cart.forEach(item => {
    const mi = document.createElement('div');
    mi.className = 'menu-item';
    mi.dataset.name = item.name;

    const rect2 = document.createElement('div'); rect2.className = 'rectangle-2';

    const img = document.createElement('img');
    img.className = 'front-view-tasty';
    img.src = item.image || 'img/image-1.png';

    const nameEl = document.createElement('div');
    nameEl.className = 'text-wrapper';
    nameEl.textContent = item.name;

    const addBtn = document.createElement('button');
    addBtn.className = 'add-btn';
    addBtn.innerHTML = `<img class="add" src="img/add.png"/>`;
    addBtn.onclick = () => addQuantityFor(item.name);

    const minusBtn = document.createElement('button');
    minusBtn.className = 'minus-btn';
    minusBtn.innerHTML = `<img class="minus" src="img/minus.png"/>`;
    minusBtn.onclick = () => decreaseQuantityFor(item.name);

    const binBtn = document.createElement('button');
    binBtn.className = 'bin-btn';
    binBtn.innerHTML = `<img class="bin" src="img/bin.png"/>`;
    binBtn.onclick = () => removeOrderFor(item.name);

    const unitPrice = parseFloat(item.price) || 0;
    const itemTotal = unitPrice * item.quantity;

    const priceEl = document.createElement('div');
    priceEl.className = 'price-BDT';
    priceEl.textContent = "BDT " + itemTotal;

    const qtyEl = document.createElement('div');
    qtyEl.className = 'text-wrapper-2';
    qtyEl.textContent = "Qty: " + item.quantity;

    mi.appendChild(rect2);
    mi.appendChild(img);
    mi.appendChild(nameEl);
    mi.appendChild(addBtn);
    mi.appendChild(minusBtn);
    mi.appendChild(binBtn);
    mi.appendChild(priceEl);
    mi.appendChild(qtyEl);

    frame.insertBefore(mi, frame.querySelector('.amount'));

    total += itemTotal;
  });

  // update varamount (bottom total)
  document.querySelector(".varamount").textContent = total;
}

    function addQuantityFor(name){
      const cart = readCart();
      const it = cart.find(i => i.name === name);
      if (!it) return;
      it.quantity = (it.quantity || 1) + 1;
      writeCart(cart);
      renderCart();
    }

    function decreaseQuantityFor(name){
      const cart = readCart();
      const it = cart.find(i => i.name === name);
      if (!it) return;
      if ((it.quantity || 1) > 1) it.quantity = it.quantity - 1;
      else {
        // remove item when quantity reaches 0
        const idx = cart.findIndex(i => i.name === name);
        if (idx !== -1) cart.splice(idx,1);
      }
      writeCart(cart);
      renderCart();
    }

    function removeOrderFor(name){
      const cart = readCart();
      const idx = cart.findIndex(i => i.name === name);
      if (idx === -1) return;
      cart.splice(idx,1);
      writeCart(cart);
      renderCart();
    }

    // initial render
    renderCart();

    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('profileDropdown');
      const profileButton = document.querySelector('.profile-button');
      if (dropdown && profileButton && !profileButton.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.classList.remove('active');
      }
    });
  </script>
</html>