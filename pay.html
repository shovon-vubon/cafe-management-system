<!DOCTYPE html>
<html>
  <head>
	<script defer src="./injectScript.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
     <div class="logo"><a href="index.html"><img class="logom" src="img/logo-1.png" /></a></div>
     <div class="nav-bar">
        <div class="buttons">
          <button class="back-button" onclick="window.history.back()"><img class="arrow" src="img/arrow.png" /></button>
          <a href="homepage.html" class="scan-button"><img class="scan" src="img/scan.png" /></a>
          <button class="profile-button" onclick="toggleProfileDropdown()"><img class="user" src="img/user.png" /></button>
        </div>
        <div id="profileDropdown" class="profile-dropdown">
          <div class="dropdown-header">
            <div class="dropdown-user-icon">
              <img class="dropdown-user" src="img/user.png" />
            </div>
            <div class="dropdown-user-info">
              <div class="dropdown-username">Table no:</div>
              <div class="dropdown-email">A3</div>
            </div>
          </div>
          <button class="logout-button" onclick="logout()">Logout</button>
        </div>
      </div>
    </header>
    <div class="pay">
    
      <img class="group" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/group-1.png" />
      
      
      <div class="ellipse"></div>
      <div class="body">
        <div class="container">
          <div class="frame">
           
            <div class="rectangle-2"></div>
            <div class="text-wrapper-2">Order Status: <div class="status-indicator"> Preparing</div> </div>
          
          <div class="element" id="countdown-timer">5 : 42</div>
          
          <img class="chair" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/chair-1.png" />
          <img class="check" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/check-1.png" />
          <img class="note" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/note-1.png" />
          <div class="text-wrapper-3">Order Placed</div>
          <div class="text-wrapper-4">Total amount: 110</div>
          <div class="text-wrapper-5">Order Id: #77225</div>
          <div class="text-wrapper-6">Table number: 21</div>
          <div class="text-wrapper-7">Token number: 30</div>
          <div class="text-wrapper-8">Estimated remaining time</div>
          <img class="money" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/money.png" />
          <img class="clipboard" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/clipboard.png" />
          <img class="vector" src="https://c.animaapp.com/mjqepxxkiP7qLZ/img/vector.svg" />
         <div class="payment-actions">
  <div class="text-wrapper-9" onclick="openPaymentModal()">Make Payment</div>

  <button class="invoice-btn" onclick="downloadInvoice()">
    <span class="icon">ðŸ“„</span>
    <span>Download Invoice</span>
  </button>
</div>

        </div>
        
        </div>
      </div>

      
      <footer class="footer">
        <div class="t-c">
          <div class="group-2">
            <div class="terms-conditions">Terms &amp; Conditions</div>
            <p class="p">Â© . All rights reserved</p>
            <div class="text-wrapper-11">Contact us</div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="payment-modal">
      <div class="payment-modal-overlay"></div>
      <div class="payment-modal-content">
        <div class="payment-header">
          <h2>Select Payment Method</h2>
          <button class="close-btn" onclick="closePaymentModal()">&times;</button>
        </div>
        <div class="payment-methods">
          <div class="payment-method-card" onclick="selectPaymentMethod(this, 'card')">
            <div class="payment-icon">ðŸ’³</div>
            <h3>Credit/Debit Card</h3>
            <p>Visa, Mastercard, Rupay</p>
            <input type="radio" name="paymentMethod" value="card" style="display:none;">
          </div>
          <div class="payment-method-card" onclick="selectPaymentMethod(this, 'mobile')">
            <div class="payment-icon">ðŸ“±</div>
            <h3>Mobile Banking</h3>
            <p>Bkash</p>
            <input type="radio" name="paymentMethod" value="mobile" style="display:none;">
          </div>
        </div>
        <div class="payment-form" id="paymentForm">
          <div id="cardForm" class="form-section">
            <input type="text" placeholder="Card Number" maxlength="16" class="payment-input">
            <div class="form-row">
              <input type="text" placeholder="MM/YY" class="payment-input">
              <input type="text" placeholder="CVV" maxlength="3" class="payment-input">
            </div>
            <input type="text" placeholder="Cardholder Name" class="payment-input">
          </div>
          <div id="mobileForm" class="form-section" style="display:none;">
            <input type="text" placeholder="Bkash Number" class="payment-input">
          </div>
        </div>
        <button class="confirm-btn" onclick="confirmPayment()">Confirm Payment</button>
      </div>
    </div>

  </body>

 <script>
let countdownInterval = null;

function startCountdown(seconds) {
  const timer = document.getElementById("countdown-timer");
  if (!timer) return;

  let remaining = seconds;

  function render() {
    const m = Math.floor(remaining / 60);
    const s = remaining % 60;
    timer.textContent = `${m} : ${s < 10 ? "0" : ""}${s}`;
  }

  render();

  if (countdownInterval) clearInterval(countdownInterval);

  countdownInterval = setInterval(() => {
    if (remaining <= 0) {
      clearInterval(countdownInterval);
      timer.textContent = "0 : 00";
      return;
    }
    remaining--;
    render();
  }, 1000);
}


// ðŸ”¥ Page load logic
document.addEventListener("DOMContentLoaded", function () {

  // TIMER
  const storedTime = localStorage.getItem("timerDuration");

  if (storedTime !== null) {
    startCountdown(parseInt(storedTime));
    localStorage.removeItem("timerDuration");   // important: reset after use
  } else {
    startCountdown(342); // default 5:42
  }

  // STATUS
  const status = localStorage.getItem("orderStatus");
  const statusEl = document.querySelector(".status-indicator");

  if (status === "Arrived") {
    statusEl.textContent = "Arrived";
  } else {
    statusEl.textContent = "Preparing";
  }

  // If page reloads â†’ force back to Preparing
  localStorage.removeItem("orderStatus");

});

// =======================
// PAYMENT MODAL CONTROL
// =======================

function openPaymentModal() {
  const modal = document.getElementById("paymentModal");
  if (modal) {
    modal.style.display = "flex";
    document.body.style.overflow = "hidden"; // stop background scroll
  }
}

function closePaymentModal() {
  const modal = document.getElementById("paymentModal");
  if (modal) {
    modal.style.display = "none";
    document.body.style.overflow = "auto";
  }
}

function selectPaymentMethod(card, method) {
  document.querySelectorAll(".payment-method-card").forEach(c => {
    c.classList.remove("active");
  });

  card.classList.add("active");

  // Toggle forms
  if (method === "card") {
    document.getElementById("cardForm").style.display = "block";
    document.getElementById("mobileForm").style.display = "none";
  } else {
    document.getElementById("cardForm").style.display = "none";
    document.getElementById("mobileForm").style.display = "block";
  }
}

function confirmPayment() {
  alert("Payment successful!");
  closePaymentModal();
}

function downloadInvoice() {
  const invoiceData = `
INVOICE
------------------------
Order ID: #77225
Table: 21
Token: 30
Total Amount: 110
Status: Preparing

Thank you for dining with us!
`;

  const blob = new Blob([invoiceData], { type: "text/plain" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "invoice_77225.txt";
  a.click();

  URL.revokeObjectURL(url);
}


</script>

</html>
